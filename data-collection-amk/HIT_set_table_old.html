<!doctype html>

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Drag and Drop</title>

    <form style="display: none;" id="Mechanictitleurk_SubmissionForm"
        action="https://www.mturk.com/mturk/externalSubmit" method="post">
        <input type="text" name="submission_data" id="submission_data" value="">
        <input type="text" name="assignmentId" id="assignmentId" value="">
        <input type="text" name="hitId" id="hitId" value="">
    </form>

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="jquery.ui.rotatable.js"></script>

    <style>
        img { max-width: 100%; max-height: 500px; }
        .column {float: left; width: 40%; margin: 10px 0.5%; box-sizing: border-box;}
        .row::after { content: ""; clear: both; display: table; text-align: center; padding-left:10%;}
        h1 {text-align: center; padding-top: 10px;}
        #containment-wrapper { margin: 0 auto; width: 448px; height:448px; border:2px solid #ccc; padding: 10px; position: relative;}
        #next_button { margin: 10px auto; width: 100px; height:40px; font-size: 18px; text-align: center; }
        #previous_button { margin: 10px auto; width: 100px; height:40px; font-size: 18px; text-align: center; visibility: hidden;}
        .ok_button { font-size : 22px; width: 30%; height: 60px; text-align: center; margin: 10px auto; display: table;}
        .instructions_splash { position: fixed; top:50%; left:50%; width:60%; background-color:#E4E4E4; transform:translate(-50%,-50%); border-style:solid; border-color:gray; border-width:3px; z-index: 70; font-size: 26px; padding: 50px;}
        .icon { position: absolute; top: 0px; left: 0px;}
        .ui-rotatable-handle { height: 12px; width: 12px; cursor: pointer;
          background-image: url(rotate.png); background-size: 100%; margin-left: 0px; left: 0px; bottom: 0px;}
    </style>

</head>

<body>


    <div id='instructions_splash_5' class="instructions_splash">
        <p style='padding-left:5%; '>

            In the end, the objects should be arranged somewhat like this:

            <div style="margin:8px auto; width: 350px">
              <img src="https://s3.amazonaws.com/nusrls/tutorial/9+table+4.jpg"/>
            </div>

        </p>

        <div style='display: flex; justify-content: center;'>
          <button type="button" id='start_button_5' class="ok_button"><strong>Ok, I am ready!</strong></button>
        </div>
    </div>




    <div id='instructions_splash_4' class="instructions_splash">
        <p style='padding-left:5%; '>
            <br><br>Rotate an object by dragging the purple icon below the object.
            <div style="margin:8px auto; width:300px; height:auto;">
              <img src="https://s3.amazonaws.com/nusrls/rotate.gif"/>
            </div>
        </p>

        <div style='display: flex; justify-content: center;'>
          <button type="button" id='start_button_4' class="ok_button"><strong>I understand</strong></button>
        </div>
    </div>






    <div id='instructions_splash_3' class="instructions_splash">
        <p style='padding-left:5%; '>

            Sometimes, the instruction can be inaccurate and imprecise. Please use your experience and wisdom to set up the table properly so our robots can learn better :)

            <br><br> In the <font style="color:#3EA6CC;"><strong>Left video</strong></font> you can see an imprecise instruction. We wish you to set up like the <font style="color:coral;"><strong>Right video</strong></font>.
            <div>
              <div class="row">
                <div class="column" style="padding:8px; padding-bottom:4px; background-color: #3EA6CC; width: 46%; margin:0; margin-right:3%;">
                  <img src="https://s3.amazonaws.com/nusrls/tutorial/21+why+previous+-+wrong.gif"/>
                </div>
                <div class="column" style="padding:8px; padding-bottom:4px; background-color: coral; width: 46%; margin:0;">
                  <img src="https://s3.amazonaws.com/nusrls/tutorial/21+why+previous+-+right.gif"/>
                </div>
              </div>
            </div>

        </p>

        <div style='display: flex; justify-content: center;'>
          <button type="button" id='start_button_3' class="ok_button"><strong>I understand</strong></button>
        </div>
    </div>




    <div id='instructions_splash_2' class="instructions_splash">
        <p style='padding-left:5%; '>

            Note that you should not only meet the requirements in the instructions, but set up the table properly and smartly.

            <br><br> For example, in a proper table-setting, <font color="red"><strong>objects should be close together</strong></font> and <strong><font style="color:#3EA6CC;">close to the bottom edge of the table</font></strong> so that it's easier for eating.

            <div style="margin:8px auto; ">
              <img src="https://s3.amazonaws.com/nusrls/tutorial/9+table+2.jpg"/>
            </div>

        </p>

        <div style='display: flex; justify-content: center;'>
          <button type="button" id='start_button_2' class="ok_button"><strong>I understand</strong></button>
        </div>
    </div>




    <div id='instructions_splash_12' class="instructions_splash">
        <p style='padding-left:5%; '>

            Once you clicked <strong>'Next'</strong>, the objects you have put on table will be locked.

            <br><br> You can click <strong>'Previous'</strong> to go back to the previous frames to revise your move.

            <div style="margin:8px auto; width: 350px">
              <img src="https://s3.amazonaws.com/nusrls/tutorial/12+previous.gif"/>
            </div>

        </p>

        <div style='display: flex; justify-content: center;'>
          <button type="button" id='start_button_12' class="ok_button"><strong>I understand</strong></button>
        </div>
    </div>




    <div id='instructions_splash_11' class="instructions_splash">
        <p style='padding-left:5%; '>

            Here are come tips for you to work on the interface.

            <br><br> When your <strong><font style="color:red;">mouse moves over an object</font></strong>, its name will be shown at your mouse tip, and also <font color="red"><strong>highlighted in red on the right of the table</strong></font>.

            <br><br> <strong><font style="color:#3EA6CC;">If you do not see the object mentioned in the instruction</font></strong>, you can use the most likely one to replace it. (e.g., use "bread plate" to replace "salad plate")

            <div style="margin:8px auto; width: 350px">
              <img src="https://s3.amazonaws.com/nusrls/tutorial/11+objects.gif"/>
            </div>

        </p>

        <div style='display: flex; justify-content: center;'>
          <button type="button" id='start_button_11' class="ok_button"><strong>I understand</strong></button>
        </div>
    </div>




    <div id='instructions_splash_02' class="instructions_splash">
        <p style='padding-left:5%; '>

            Your movement will be recorded so the robot can learn how to set up a dinner table in an simulated envirnment.

            <div style="margin:8px auto; ">
              <img src="https://s3.amazonaws.com/nusrls/purpose.png"/>
            </div>

        </p>

        <div style='display: flex; justify-content: center;'>
          <button type="button" id='start_button_02' class="ok_button"><strong>That's Great!</strong></button>
        </div>
    </div>





    <div id='instructions_splash_01' class="instructions_splash">
        <p style='padding-left:5%; '>

            Your task is to <font color="red"><strong>drag-and-drop objects onto the brown table cloth according to instructions</strong></font> given on the top of the page.

            <br><br> On the page, you can see <font style="color:#3EA6CC;"><strong>an animation of the before-after images above the right arrow</strong></font>. It will help you understand the action faster.

            <div style="margin:8px auto; width: 350px">
              <img src="https://s3.amazonaws.com/nusrls/tutorial/22+why+previous+-+right.gif"/>
            </div>

        </p>

        <div style='display: flex; justify-content: center;'>
          <button type="button" id='start_button_01' class="ok_button"><strong>I understand</strong></button>
        </div>
    </div>



    <div id='instructions_splash_00' class="instructions_splash">
        <p >
            Welcome! You will contribute to our research that <font color="red"><strong>teaches this robot to set up a dinner table</strong></font>.
            <div style="margin: auto; width: 80%;">
              <img src="https://s3.amazonaws.com/nusrls/tutorial/00+meet+MICO.gif"/>
            </div>
            <br>We will first give you a two-minute tutorial of how to do that ;)
        </p>

        <div style='display: flex; justify-content: center;'>
          <button type="button" id='start_button_00' class="ok_button" width="700px"><strong>Ok, show me how I can contribute</strong></button>
        </div>
    </div>






    <!-- on top is instruction, randomly selected from array of 100 human expressions -->
    <div id="myProgress" style="width: 100%; background-color: #ddd; ">
        <div id="myBar" style="width: 1%; height: 10px; background-color: #4CAF50;"></div>
    </div>


    <h1 id='instruction' style="margin:0;">
        Follow this instruction
    </h1>


    <!-- <div style="style='display: flex; justify-content: center;'">
    </div> -->
    <div style="margin-top:10px; display: table; margin: 0 auto; text-align: center;">
        <button id="previous_button">Previous</button>
        <button id="next_button">Next</button>
    </div>

    <div id="containment-wrapper">

        <div id="dg_bread_plate" class="icon">
            <div><img src="https://s3.amazonaws.com/nusrls/objects/Bread Plate.png" title="Bread Plate" width="72px" height="72px"/>
        </div></div>

        <div id="dg_charger" class="icon">
            <div><img src="https://s3.amazonaws.com/nusrls/objects/Charger.png" title="Charger" width="122px" height="122px"/>
        </div></div>

        <div id="dg_coffee" class="icon">
            <div><img src="https://s3.amazonaws.com/nusrls/objects/Coffee.png" title="Coffee Plate" width="77px" height="77px"/>
        </div></div>

        <div id="dg_dinner_plate" class="icon">
            <div><img src="https://s3.amazonaws.com/nusrls/objects/Dinner Plate.png" title="Dinner Plate" width="93px" height="93px"/>
        </div></div>

        <div id="dg_napkin" class="icon">
            <div><img src="https://s3.amazonaws.com/nusrls/objects/Napkin.png" title="Napkin" width="33px" height="93px"/>
        </div></div>

        <div id="dg_water_glass" class="icon">
            <div><img src="https://s3.amazonaws.com/nusrls/objects/Water Glass.png" title="Water Glass" width="34px" height="34px"/>
        </div></div>

        <div id="dg_wine_glass" class="icon">
            <div><img src="https://s3.amazonaws.com/nusrls/objects/Wine Glass.png" title="Wine Glass" width="35px" height="35px"/>
        </div></div>

        <div id="dg_wine_glass_1" class="icon">
            <div><img src="https://s3.amazonaws.com/nusrls/objects/Wine Glass (1).png" title="Wine Glass (1)" width="35px" height="35px"/>
        </div></div>

        <div id="dg_wine_glass_2" class="icon">
            <div><img src="https://s3.amazonaws.com/nusrls/objects/Wine Glass (2).png" title="Wine Glass (2)" width="35px" height="35px"/>
        </div></div>

        <div id="dg_table_cloth" class="icon">
            <div><img src="https://s3.amazonaws.com/nusrls/objects/Table Cloth.png" title="Table Cloth" width="370px" height="226px"/>
        </div></div>



        <div id="dg_butter_knife" class="icon">
            <div id="rt_butter_knife"><img src="https://s3.amazonaws.com/nusrls/objects/Butter Knife.png" title="Butter Knife" width="8.4px" height="60px"/>
        </div></div>

        <div id="dg_dessert_fork" class="icon">
            <div id="rt_dessert_fork"><img src="https://s3.amazonaws.com/nusrls/objects/Dessert Fork.png" title="Dessert Fork" width="10.4px" height="60px"/>
        </div></div>

        <div id="dg_dessert_spoon" class="icon">
            <div id="rt_dessert_spoon"><img src="https://s3.amazonaws.com/nusrls/objects/Dessert Spoon.png" title="Dessert Spoon" width="11.5px" height="57px"/>
        </div></div>

        <div id="dg_dinner_fork" class="icon">
            <div id="rt_dinner_fork"><img src="https://s3.amazonaws.com/nusrls/objects/Dinner Fork.png" title="Dinner Fork" width="14px" height="89px"/>
        </div></div>

        <div id="dg_dinner_knife" class="icon">
            <div id="rt_dinner_knife"><img src="https://s3.amazonaws.com/nusrls/objects/Dinner Knife.png" title="Dinner Knife" width="12px" height="92.6px"/>
        </div></div>

        <div id="dg_salad_fork" class="icon">
            <div id="rt_salad_fork"><img src="https://s3.amazonaws.com/nusrls/objects/Salad Fork.png" title="Salad Fork" width="12px" height="74px"/>
        </div></div>

        <div id="dg_salad_knife" class="icon">
            <div id="rt_salad_knife"><img src="https://s3.amazonaws.com/nusrls/objects/Salad Knife.png" title="Salad Knife" width="12px" height="82px"/>
        </div></div>

        <div id="dg_soup_spoon" class="icon">
            <div id="rt_soup_spoon"><img src="https://s3.amazonaws.com/nusrls/objects/Soup Spoon.png" title="Soup Spoon" width="16px" height="74px"/>
        </div>
    </div>


    <div id="objects" style="position: relative; left: 480px;">

        <div id="loc_bread_plate">Bread plate: </div>
        <div id="loc_charger">Charger: </div>
        <div id="loc_coffee">Coffee: </div>
        <div id="loc_dinner_plate">Dinner plate: </div>
        <div id="loc_napkin">Napkin: </div>
        <div id="loc_water_glass">Water glass: </div>
        <div id="loc_wine_glass">Wine glass (left): </div>
        <div id="loc_wine_glass_2">Wine glass (middle): </div>
        <div id="loc_wine_glass_1">Wine glass (right): </div>

        <div id="loc_butter_knife">Butter knife: </div>
        <div id="rot_butter_knife">Butter knife: </div>

        <div id="loc_dessert_fork">Dessert fork: </div>
        <div id="rot_dessert_fork">Dessert fork: </div>

        <div id="loc_dessert_spoon">Dessert spoon: </div>
        <div id="rot_dessert_spoon">Dessert spoon: </div>

        <div id="loc_dinner_fork">Dinner fork: </div>
        <div id="rot_dinner_fork">Dinner fork: </div>

        <div id="loc_dinner_knife">Dinner knife: </div>
        <div id="rot_dinner_knife">Dinner knife: </div>

        <div id="loc_salad_fork">Salad fork: </div>
        <div id="rot_salad_fork">Salad fork: </div>

        <div id="loc_salad_knife">Salad knife: </div>
        <div id="rot_salad_knife">Salad knife: </div>

        <div id="loc_soup_spoon">Soup spoon: </div>
        <div id="rot_soup_spoon">Soup spoon: </div>

    </div>

</div>

</body>

<script>

var things_not_rotatable = ["bread_plate", "charger", "coffee", "dinner_plate",
                        "napkin", "water_glass", "wine_glass", "wine_glass_1", "wine_glass_2"]

var things_rotatable = ["butter_knife", "dessert_fork", "dessert_spoon", "dinner_fork",
                      "dinner_knife", "salad_fork", "salad_knife","soup_spoon"]

var things_all = things_not_rotatable.concat(things_rotatable)

// Have subject read instructions and click button to close

$('#start_button_00').click(function() {
    document.getElementById('instructions_splash_00').style.visibility = 'hidden'
})

$('#start_button_01').click(function() {
    document.getElementById('instructions_splash_01').style.visibility = 'hidden'
})

$('#start_button_02').click(function() {
    document.getElementById('instructions_splash_02').style.visibility = 'hidden'
})

$('#start_button_11').click(function() {
    document.getElementById('instructions_splash_11').style.visibility = 'hidden'
})

$('#start_button_12').click(function() {
    document.getElementById('instructions_splash_12').style.visibility = 'hidden'
})

$('#start_button_2').click(function() {
    document.getElementById('instructions_splash_2').style.visibility = 'hidden'
})

$('#start_button_3').click(function() {
    document.getElementById('instructions_splash_3').style.visibility = 'hidden'
})

$('#start_button_4').click(function() {
    document.getElementById('instructions_splash_4').style.visibility = 'hidden'
})

$('#start_button_5').click(function() {
    document.getElementById('instructions_splash_5').style.visibility = 'hidden'
})

$('#start_button_6').click(function() {
    document.getElementById('instructions_splash_6').style.visibility = 'hidden'
})







document.getElementById("dg_bread_plate").addEventListener("mouseover", mouseOverdg_bread_plate);
document.getElementById("dg_bread_plate").addEventListener("mouseout", mouseOutdg_bread_plate);
function mouseOverdg_bread_plate() {
  document.getElementById("loc_bread_plate").style.color = "red";
  document.getElementById("loc_bread_plate").style.fontSize = "24px";
}
function mouseOutdg_bread_plate() {
  document.getElementById("loc_bread_plate").style.color = "black";
  document.getElementById("loc_bread_plate").style.fontSize = "16px";
}


document.getElementById("dg_charger").addEventListener("mouseover", mouseOverdg_charger);
document.getElementById("dg_charger").addEventListener("mouseout", mouseOutdg_charger);
function mouseOverdg_charger() {
  document.getElementById("loc_charger").style.color = "red";
  document.getElementById("loc_charger").style.fontSize = "24px";
}
function mouseOutdg_charger() {
  document.getElementById("loc_charger").style.color = "black";
  document.getElementById("loc_charger").style.fontSize = "16px";
}

document.getElementById("dg_coffee").addEventListener("mouseover", mouseOverdg_coffee);
document.getElementById("dg_coffee").addEventListener("mouseout", mouseOutdg_coffee);
function mouseOverdg_coffee() {
  document.getElementById("loc_coffee").style.color = "red";
  document.getElementById("loc_coffee").style.fontSize = "24px";
}
function mouseOutdg_coffee() {
  document.getElementById("loc_coffee").style.color = "black";
  document.getElementById("loc_coffee").style.fontSize = "16px";
}


document.getElementById("dg_dinner_plate").addEventListener("mouseover", mouseOverdg_dinner_plate);
document.getElementById("dg_dinner_plate").addEventListener("mouseout", mouseOutdg_dinner_plate);
function mouseOverdg_dinner_plate() {
  document.getElementById("loc_dinner_plate").style.color = "red";
  document.getElementById("loc_dinner_plate").style.fontSize = "24px";
}
function mouseOutdg_dinner_plate() {
  document.getElementById("loc_dinner_plate").style.color = "black";
  document.getElementById("loc_dinner_plate").style.fontSize = "16px";
}


document.getElementById("dg_napkin").addEventListener("mouseover", mouseOverdg_napkin);
document.getElementById("dg_napkin").addEventListener("mouseout", mouseOutdg_napkin);
function mouseOverdg_napkin() {
  document.getElementById("loc_napkin").style.color = "red";
  document.getElementById("loc_napkin").style.fontSize = "24px";
}
function mouseOutdg_napkin() {
  document.getElementById("loc_napkin").style.color = "black";
  document.getElementById("loc_napkin").style.fontSize = "16px";
}


document.getElementById("dg_water_glass").addEventListener("mouseover", mouseOverdg_water_glass);
document.getElementById("dg_water_glass").addEventListener("mouseout", mouseOutdg_water_glass);
function mouseOverdg_water_glass() {
  document.getElementById("loc_water_glass").style.color = "red";
  document.getElementById("loc_water_glass").style.fontSize = "24px";
}
function mouseOutdg_water_glass() {
  document.getElementById("loc_water_glass").style.color = "black";
  document.getElementById("loc_water_glass").style.fontSize = "16px";
}


document.getElementById("dg_wine_glass").addEventListener("mouseover", mouseOverdg_wine_glass);
document.getElementById("dg_wine_glass").addEventListener("mouseout", mouseOutdg_wine_glass);
function mouseOverdg_wine_glass() {
  document.getElementById("loc_wine_glass").style.color = "red";
  document.getElementById("loc_wine_glass").style.fontSize = "24px";
}
function mouseOutdg_wine_glass() {
  document.getElementById("loc_wine_glass").style.color = "black";
  document.getElementById("loc_wine_glass").style.fontSize = "16px";
}


document.getElementById("dg_wine_glass_1").addEventListener("mouseover", mouseOverdg_wine_glass_1);
document.getElementById("dg_wine_glass_1").addEventListener("mouseout", mouseOutdg_wine_glass_1);
function mouseOverdg_wine_glass_1() {
  document.getElementById("loc_wine_glass_1").style.color = "red";
  document.getElementById("loc_wine_glass_1").style.fontSize = "24px";
}
function mouseOutdg_wine_glass_1() {
  document.getElementById("loc_wine_glass_1").style.color = "black";
  document.getElementById("loc_wine_glass_1").style.fontSize = "16px";
}


document.getElementById("dg_wine_glass_2").addEventListener("mouseover", mouseOverdg_wine_glass_2);
document.getElementById("dg_wine_glass_2").addEventListener("mouseout", mouseOutdg_wine_glass_2);
function mouseOverdg_wine_glass_2() {
  document.getElementById("loc_wine_glass_2").style.color = "red";
  document.getElementById("loc_wine_glass_2").style.fontSize = "24px";
}
function mouseOutdg_wine_glass_2() {
  document.getElementById("loc_wine_glass_2").style.color = "black";
  document.getElementById("loc_wine_glass_2").style.fontSize = "16px";
}


document.getElementById("dg_butter_knife").addEventListener("mouseover", mouseOverdg_butter_knife);
document.getElementById("dg_butter_knife").addEventListener("mouseout", mouseOutdg_butter_knife);
function mouseOverdg_butter_knife() {
  document.getElementById("loc_butter_knife").style.color = "red";
  document.getElementById("loc_butter_knife").style.fontSize = "24px";
  document.getElementById("rot_butter_knife").style.color = "red";
  document.getElementById("rot_butter_knife").style.fontSize = "24px";
}
function mouseOutdg_butter_knife() {
  document.getElementById("loc_butter_knife").style.color = "black";
  document.getElementById("loc_butter_knife").style.fontSize = "16px";
  document.getElementById("rot_butter_knife").style.color = "black";
  document.getElementById("rot_butter_knife").style.fontSize = "16px";
}


document.getElementById("dg_dessert_fork").addEventListener("mouseover", mouseOverdg_dessert_fork);
document.getElementById("dg_dessert_fork").addEventListener("mouseout", mouseOutdg_dessert_fork);
function mouseOverdg_dessert_fork() {
  document.getElementById("loc_dessert_fork").style.color = "red";
  document.getElementById("loc_dessert_fork").style.fontSize = "24px";
  document.getElementById("rot_dessert_fork").style.color = "red";
  document.getElementById("rot_dessert_fork").style.fontSize = "24px";
}
function mouseOutdg_dessert_fork() {
  document.getElementById("loc_dessert_fork").style.color = "black";
  document.getElementById("loc_dessert_fork").style.fontSize = "16px";
  document.getElementById("rot_dessert_fork").style.color = "black";
  document.getElementById("rot_dessert_fork").style.fontSize = "16px";
}


document.getElementById("dg_dessert_spoon").addEventListener("mouseover", mouseOverdg_dessert_spoon);
document.getElementById("dg_dessert_spoon").addEventListener("mouseout", mouseOutdg_dessert_spoon);
function mouseOverdg_dessert_spoon() {
  document.getElementById("loc_dessert_spoon").style.color = "red";
  document.getElementById("loc_dessert_spoon").style.fontSize = "24px";
  document.getElementById("rot_dessert_spoon").style.color = "red";
  document.getElementById("rot_dessert_spoon").style.fontSize = "24px";
}
function mouseOutdg_dessert_spoon() {
  document.getElementById("loc_dessert_spoon").style.color = "black";
  document.getElementById("loc_dessert_spoon").style.fontSize = "16px";
  document.getElementById("rot_dessert_spoon").style.color = "black";
  document.getElementById("rot_dessert_spoon").style.fontSize = "16px";
}


document.getElementById("dg_dinner_fork").addEventListener("mouseover", mouseOverdg_dinner_fork);
document.getElementById("dg_dinner_fork").addEventListener("mouseout", mouseOutdg_dinner_fork);
function mouseOverdg_dinner_fork() {
  document.getElementById("loc_dinner_fork").style.color = "red";
  document.getElementById("loc_dinner_fork").style.fontSize = "24px";
  document.getElementById("rot_dinner_fork").style.color = "red";
  document.getElementById("rot_dinner_fork").style.fontSize = "24px";
}
function mouseOutdg_dinner_fork() {
  document.getElementById("loc_dinner_fork").style.color = "black";
  document.getElementById("loc_dinner_fork").style.fontSize = "16px";
  document.getElementById("rot_dinner_fork").style.color = "black";
  document.getElementById("rot_dinner_fork").style.fontSize = "16px";
}


document.getElementById("dg_dinner_knife").addEventListener("mouseover", mouseOverdg_dinner_knife);
document.getElementById("dg_dinner_knife").addEventListener("mouseout", mouseOutdg_dinner_knife);
function mouseOverdg_dinner_knife() {
  document.getElementById("loc_dinner_knife").style.color = "red";
  document.getElementById("loc_dinner_knife").style.fontSize = "24px";
  document.getElementById("rot_dinner_knife").style.color = "red";
  document.getElementById("rot_dinner_knife").style.fontSize = "24px";
}
function mouseOutdg_dinner_knife() {
  document.getElementById("loc_dinner_knife").style.color = "black";
  document.getElementById("loc_dinner_knife").style.fontSize = "16px";
  document.getElementById("rot_dinner_knife").style.color = "black";
  document.getElementById("rot_dinner_knife").style.fontSize = "16px";
}


document.getElementById("dg_salad_fork").addEventListener("mouseover", mouseOverdg_salad_fork);
document.getElementById("dg_salad_fork").addEventListener("mouseout", mouseOutdg_salad_fork);
function mouseOverdg_salad_fork() {
  document.getElementById("loc_salad_fork").style.color = "red";
  document.getElementById("loc_salad_fork").style.fontSize = "24px";
  document.getElementById("rot_salad_fork").style.color = "red";
  document.getElementById("rot_salad_fork").style.fontSize = "24px";
}
function mouseOutdg_salad_fork() {
  document.getElementById("loc_salad_fork").style.color = "black";
  document.getElementById("loc_salad_fork").style.fontSize = "16px";
  document.getElementById("rot_salad_fork").style.color = "black";
  document.getElementById("rot_salad_fork").style.fontSize = "16px";
}


document.getElementById("dg_salad_knife").addEventListener("mouseover", mouseOverdg_salad_knife);
document.getElementById("dg_salad_knife").addEventListener("mouseout", mouseOutdg_salad_knife);
function mouseOverdg_salad_knife() {
  document.getElementById("loc_salad_knife").style.color = "red";
  document.getElementById("loc_salad_knife").style.fontSize = "24px";
  document.getElementById("rot_salad_knife").style.color = "red";
  document.getElementById("rot_salad_knife").style.fontSize = "24px";
}
function mouseOutdg_salad_knife() {
  document.getElementById("loc_salad_knife").style.color = "black";
  document.getElementById("loc_salad_knife").style.fontSize = "16px";
  document.getElementById("rot_salad_knife").style.color = "black";
  document.getElementById("rot_salad_knife").style.fontSize = "16px";
}


document.getElementById("dg_soup_spoon").addEventListener("mouseover", mouseOverdg_soup_spoon);
document.getElementById("dg_soup_spoon").addEventListener("mouseout", mouseOutdg_soup_spoon);
function mouseOverdg_soup_spoon() {
  document.getElementById("loc_soup_spoon").style.color = "red";
  document.getElementById("loc_soup_spoon").style.fontSize = "24px";
  document.getElementById("rot_soup_spoon").style.color = "red";
  document.getElementById("rot_soup_spoon").style.fontSize = "24px";
}
function mouseOutdg_soup_spoon() {
  document.getElementById("loc_soup_spoon").style.color = "black";
  document.getElementById("loc_soup_spoon").style.fontSize = "16px";
  document.getElementById("rot_soup_spoon").style.color = "black";
  document.getElementById("rot_soup_spoon").style.fontSize = "16px";
}



function _extract_url_string(url, key, defaultValue) {
    var name = key
    key = key.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regexS = "[\\?&]" + key + "=([^&#]*)";
    var regex = new RegExp(regexS);
    var results = regex.exec(url) || ["", defaultValue]

    return results[1]
}

function get_assignmentId_from_url(url) {
    var assignmentId = _extract_url_string(url, 'assignmentId', 'assignmentId_not_found')
    console.log('assignmentId', assignmentId)

    return assignmentId
}

function detect_sandbox_mode(url) {
    var submitToURL = _extract_url_string(url, 'turkSubmitTo', 'https://www.mturk.com')
    console.log('submittoURL', submitToURL)
    try {
        if (submitToURL.indexOf('workersandbox') != -1) {
            var inSandboxMode = true
        } else {
            var inSandboxMode = false
        }
    } catch (error) {
        console.log(error)
        var inSandboxMode = false
    }
    return inSandboxMode

}

// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// ~~~~~ Define draggable objects ~~~~~
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

$(function() {

    var offset = 0,
        xPos = 0,
        yPos = 0;

    $('#dg_bread_plate').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_bread_plate").html('Bread plate: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_charger').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_charger").html('Charger: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_coffee').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_coffee").html('Coffee: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_dinner_plate').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_dinner_plate").html('Dinner plate: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_napkin').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_napkin").html('Napkin: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_water_glass').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_water_glass").html('Water glass: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_wine_glass').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_wine_glass").html('Wine glass (left): (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_wine_glass_1').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_wine_glass_1").html('Wine glass (right): (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_wine_glass_2').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_wine_glass_2").html('Wine glass (middle): (' + xPos + ', ' + yPos + ')');
        }
    });



    $('#dg_butter_knife').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_butter_knife").html('Butter knife: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_dessert_fork').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_dessert_fork").html('Dessert fork: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_dessert_spoon').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_dessert_spoon").html('Dessert spoon: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_dinner_fork').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_dinner_fork").html('Dinner fork: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_dinner_knife').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_dinner_knife").html('Dinner knife: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_salad_fork').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_salad_fork").html('Salad fork: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_salad_knife').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_salad_knife").html('Salad knife: (' + xPos + ', ' + yPos + ')');
        }
    });

    $('#dg_soup_spoon').draggable({
        containment: "#containment-wrapper",
        stack: "#containment-wrapper div",
        scroll: false,
        drag: function() {
            offset = $(this).position();
            xPos = offset.left;
            yPos = offset.top;
            $("#loc_soup_spoon").html('Soup spoon: (' + xPos + ', ' + yPos + ')');
        }
    });

});

// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// ~~~~~ Define instructions ~~~~~
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

// var instructions = [
//     "put the knife on the right of the plate",
//     "move the fork above the plate",
//     // "put the fork between the plate and the knife",
//     "you add the knife below the plate",
//     "fork on the plate"
// ];

function rand(min, max) { return Math.floor(Math.random() * (max - min) + min); }

function initiateTable() {

    $('#rt_butter_knife').rotatable({
      stop: function(event, ui) {
          $("#rot_butter_knife").html('Butter knife: '+ui.angle.stop / Math.PI * 180)
        },
      }
    );
    $("#rot_butter_knife").html('Butter knife: ')

    $('#rt_dessert_fork').rotatable({
      stop: function(event, ui) {
          $("#rot_dessert_fork").html('Dessert fork: '+ui.angle.stop / Math.PI * 180)
        },
      }
    );
    $("#rot_dessert_fork").html('Dessert fork: ')

    $('#rt_dessert_spoon').rotatable({
      stop: function(event, ui) {
          $("#rot_dessert_spoon").html('Dessert spoon: '+ui.angle.stop / Math.PI * 180)
        },
      }
    );
    $("#rot_dessert_spoon").html('Dessert spoon: ')

    $('#rt_dinner_fork').rotatable({
      stop: function(event, ui) {
          $("#rot_dinner_fork").html('Dinner fork: '+ui.angle.stop / Math.PI * 180)
        },
      }
    );
    $("#rot_dinner_fork").html('Dinner fork: ')

    $('#rt_dinner_knife').rotatable({
      stop: function(event, ui) {
          $("#rot_dinner_knife").html('Dinner knife: '+ui.angle.stop / Math.PI * 180)
        },
      }
    );
    $("#rot_dinner_knife").html('Dinner knife: ')

    $('#rt_salad_fork').rotatable({
      stop: function(event, ui) {
          $("#rot_salad_fork").html('Salad fork: '+ui.angle.stop / Math.PI * 180)
        },
      }
    );
    $("#rot_salad_fork").html('Salad fork: ')

    $('#rt_salad_knife').rotatable({
      stop: function(event, ui) {
          $("#rot_salad_knife").html('Salad knife: '+ui.angle.stop / Math.PI * 180)
        },
      }
    );
    $("#rot_salad_knife").html('Salad knife: ')

    $('#rt_soup_spoon').rotatable({
      stop: function(event, ui) {
          $("#rot_soup_spoon").html('Soup spoon: '+ui.angle.stop / Math.PI * 180)
        },
      }
    );
    $("#rot_soup_spoon").html('Soup spoon: ')


    var yRand = 0, xRand = 0;

    xRand = 41.13731003
    yRand = 197.4078827
    $("#loc_table_cloth").html('Table cloth: (' + xRand + ', ' + yRand + ')');
    $("#dg_table_cloth").css({ 'top': yRand, 'left': xRand });

    xRand = 197.2446814
    yRand = 105.6034718
    $("#loc_bread_plate").html('Bread plate: (' + xRand + ', ' + yRand + ')');
    $("#dg_bread_plate").css({ 'top': yRand, 'left': xRand });

    xRand = 48.32164001
    yRand = 13.03745461
    $("#loc_charger").html('Charger: (' + xRand + ', ' + yRand + ')');
    $("#dg_charger").css({ 'top': yRand, 'left': xRand });

    xRand = 315.7017517
    yRand = 10.35802078
    $("#loc_coffee").html('Coffee: (' + xRand + ', ' + yRand + ')');
    $("#dg_coffee").css({ 'top': yRand, 'left': xRand });

    xRand = 177.9575577
    yRand = 13.68432522
    $("#loc_napkin").html('Napkin: (' + xRand + ', ' + yRand + ')');
    $("#dg_napkin").css({ 'top': yRand, 'left': xRand });

    xRand = 214.4677658
    yRand = 9.324058533
    $("#loc_dinner_plate").html('Dinner plate: (' + xRand + ', ' + yRand + ')');
    $("#dg_dinner_plate").css({ 'top': yRand, 'left': xRand });

    xRand = 157.9165115
    yRand = 109.3443751
    $("#loc_water_glass").html('Water glass: (' + xRand + ', ' + yRand + ')');
    $("#dg_water_glass").css({ 'top': yRand, 'left': xRand });

    xRand = 44.02829742
    yRand = 135.6775379
    $("#loc_wine_glass").html('Wine glass (left): (' + xRand + ', ' + yRand + ')');
    $("#dg_wine_glass").css({ 'top': yRand, 'left': xRand });

    xRand = 84.16909933
    yRand = 136.74827
    $("#loc_wine_glass_2").html('Wine glass (middle): (' + xRand + ', ' + yRand + ')');
    $("#dg_wine_glass_2").css({ 'top': yRand, 'left': xRand });

    xRand = 123.8081341
    yRand = 136.3137074
    $("#loc_wine_glass_1").html('Wine glass (right): (' + xRand + ', ' + yRand + ')');
    $("#dg_wine_glass_1").css({ 'top': yRand, 'left': xRand });




    xRand = 354.5673141
    yRand = 115.9997978
    $("#loc_butter_knife").html('Butter knife: (' + xRand + ', ' + yRand + ')');
    $("#dg_butter_knife").css({ 'top': yRand, 'left': xRand });
    document.getElementById('rt_butter_knife').style.transform = 'none'

    xRand = 290.832798
    yRand = 119.4993172
    $("#loc_dessert_fork").html('Dessert fork: (' + xRand + ', ' + yRand + ')');
    $("#dg_dessert_fork").css({ 'top': yRand, 'left': xRand });
    document.getElementById('rt_dessert_fork').style.transform = 'none'

    xRand = 275.8578758
    yRand = 121.9755554
    $("#loc_dessert_spoon").html('Dessert spoon: (' + xRand + ', ' + yRand + ')');
    $("#dg_dessert_spoon").css({ 'top': yRand, 'left': xRand });
    document.getElementById('rt_dessert_spoon').style.transform = 'none'

    xRand = 321.2024384
    yRand = 89.50162125
    $("#loc_dinner_fork").html('Dinner fork: (' + xRand + ', ' + yRand + ')');
    $("#dg_dinner_fork").css({ 'top': yRand, 'left': xRand });
    document.getElementById('rt_dinner_fork').style.transform = 'none'

    xRand = 383.7730827
    yRand = 85.19843864
    $("#loc_dinner_knife").html('Dinner knife: (' + xRand + ', ' + yRand + ')');
    $("#dg_dinner_knife").css({ 'top': yRand, 'left': xRand });
    document.getElementById('rt_dinner_knife').style.transform = 'none'

    xRand = 338.2376747
    yRand = 105.3717275
    $("#loc_salad_fork").html('Salad fork: (' + xRand + ', ' + yRand + ')');
    $("#dg_salad_fork").css({ 'top': yRand, 'left': xRand });
    document.getElementById('rt_salad_fork').style.transform = 'none'

    xRand = 367.5925255
    yRand = 97.77871656
    $("#loc_salad_knife").html('Salad knife: (' + xRand + ', ' + yRand + ')');
    $("#dg_salad_knife").css({ 'top': yRand, 'left': xRand });
    document.getElementById('rt_salad_knife').style.transform = 'none'

    xRand = 304.0075989
    yRand = 104.1904354
    $("#loc_soup_spoon").html('Soup spoon: (' + xRand + ', ' + yRand + ')');
    $("#dg_soup_spoon").css({ 'top': yRand, 'left': xRand });
    document.getElementById('rt_soup_spoon').style.transform = 'none'

}

function updateInstruction() {
    // $("#instruction").html((t+1)+ " out of "+ instructions.length +" : "+instructions[t]);
    $("#instruction").html(instructions[t]);
    document.getElementById("myBar").style.width = (t/instructions.length*100) + '%';
}

// Have subject read instructions and click button to close
$('#previous_button').click(function() {

    t--;
    console.log('previous!!!'+t);
    updateInstruction()

    if (t != 0) {

        var previous_locations = dataobj.locations[t-1]
        var yRand = 0, xRand = 0;

        xRand = previous_locations[1]
        yRand = previous_locations[2]
        $("#loc_bread_plate").html('Bread plate: (' + xRand + ', ' + yRand + ')');
        $("#dg_bread_plate").css({ 'top': yRand, 'left': xRand });

        xRand = previous_locations[5]
        yRand = previous_locations[6]
        $("#loc_charger").html('Charger: (' + xRand + ', ' + yRand + ')');
        $("#dg_charger").css({ 'top': yRand, 'left': xRand });

        xRand = previous_locations[9]
        yRand = previous_locations[10]
        $("#loc_coffee").html('Coffee: (' + xRand + ', ' + yRand + ')');
        $("#dg_coffee").css({ 'top': yRand, 'left': xRand });

        xRand = previous_locations[13]
        yRand = previous_locations[14]
        $("#loc_dinner_plate").html('Dinner plate: (' + xRand + ', ' + yRand + ')');
        $("#dg_dinner_plate").css({ 'top': yRand, 'left': xRand });

        xRand = previous_locations[17]
        yRand = previous_locations[18]
        $("#loc_napkin").html('Napkin: (' + xRand + ', ' + yRand + ')');
        $("#dg_napkin").css({ 'top': yRand, 'left': xRand });

        xRand = previous_locations[21]
        yRand = previous_locations[22]
        $("#loc_water_glass").html('Water glass: (' + xRand + ', ' + yRand + ')');
        $("#dg_water_glass").css({ 'top': yRand, 'left': xRand });

        xRand = previous_locations[25]
        yRand = previous_locations[26]
        $("#loc_wine_glass").html('Wine glass (left): (' + xRand + ', ' + yRand + ')');
        $("#dg_wine_glass").css({ 'top': yRand, 'left': xRand });

        xRand = previous_locations[29]
        yRand = previous_locations[30]
        $("#loc_wine_glass_1").html('Wine glass (right): (' + xRand + ', ' + yRand + ')');
        $("#dg_wine_glass_1").css({ 'top': yRand, 'left': xRand });

        xRand = previous_locations[33]
        yRand = previous_locations[34]
        $("#loc_wine_glass_2").html('Wine glass (middle): (' + xRand + ', ' + yRand + ')');
        $("#dg_wine_glass_2").css({ 'top': yRand, 'left': xRand });




        xRand = previous_locations[37]
        yRand = previous_locations[38]
        $("#loc_butter_knife").html('Butter knife: (' + xRand + ', ' + yRand + ')');
        $("#dg_butter_knife").css({ 'top': yRand, 'left': xRand });
        document.getElementById('rt_butter_knife').style.transform = 'rotate(' + previous_locations[39] + 'deg)'
        console.log('rotate(' + previous_locations[39] + 'deg)')
        console.log(document.getElementById('rt_butter_knife').style.transform)
        $("#rot_butter_knife").html('Butter knife: '+previous_locations[39])

        xRand = previous_locations[41]
        yRand = previous_locations[42]
        $("#loc_dessert_fork").html('Dessert fork: (' + xRand + ', ' + yRand + ')');
        $("#dg_dessert_fork").css({ 'top': yRand, 'left': xRand });
        document.getElementById('rt_dessert_fork').style.transform = 'rotate(' + previous_locations[43] + 'deg)'
        console.log('rotate(' + previous_locations[43] + 'deg)')
        console.log(document.getElementById('rt_dessert_fork').style.transform)
        $("#rot_dessert_fork").html('Dessert fork: '+previous_locations[43])

        xRand = previous_locations[45]
        yRand = previous_locations[46]
        $("#loc_dessert_spoon").html('Dessert spoon: (' + xRand + ', ' + yRand + ')');
        $("#dg_dessert_spoon").css({ 'top': yRand, 'left': xRand });
        document.getElementById('rt_dessert_spoon').style.transform = 'rotate(' + previous_locations[47] + 'deg)'
        $("#rot_dessert_spoon").html('Dessert spoon: '+previous_locations[47])

        xRand = previous_locations[49]
        yRand = previous_locations[50]
        $("#loc_dinner_fork").html('Dinner fork: (' + xRand + ', ' + yRand + ')');
        $("#dg_dinner_fork").css({ 'top': yRand, 'left': xRand });
        document.getElementById('rt_dinner_fork').style.transform = 'rotate(' + previous_locations[51] + 'deg)'
        $("#rot_dinner_fork").html('Dinner fork: '+previous_locations[51])

        xRand = previous_locations[53]
        yRand = previous_locations[54]
        $("#loc_dinner_knife").html('Dinner knife: (' + xRand + ', ' + yRand + ')');
        $("#dg_dinner_knife").css({ 'top': yRand, 'left': xRand });
        document.getElementById('rt_dinner_knife').style.transform = 'rotate(' + previous_locations[55] + 'deg)'
        $("#rot_dinner_knife").html('Dinner knife: '+previous_locations[55])

        xRand = previous_locations[57]
        yRand = previous_locations[58]
        $("#loc_salad_fork").html('Salad fork: (' + xRand + ', ' + yRand + ')');
        $("#dg_salad_fork").css({ 'top': yRand, 'left': xRand });
        document.getElementById('rt_salad_fork').style.transform = 'rotate(' + previous_locations[59] + 'deg)'
        $("#rot_salad_fork").html('Salad fork: '+previous_locations[59])

        xRand = previous_locations[61]
        yRand = previous_locations[62]
        $("#loc_salad_knife").html('Salad knife: (' + xRand + ', ' + yRand + ')');
        $("#dg_salad_knife").css({ 'top': yRand, 'left': xRand });
        document.getElementById('rt_salad_knife').style.transform = 'rotate(' + previous_locations[63] + 'deg)'
        $("#rot_salad_knife").html('Salad knife: '+previous_locations[63])

        xRand = previous_locations[65]
        yRand = previous_locations[66]
        $("#loc_soup_spoon").html('Soup spoon: (' + xRand + ', ' + yRand + ')');
        $("#dg_soup_spoon").css({ 'top': yRand, 'left': xRand });
        document.getElementById('rt_soup_spoon').style.transform = 'rotate(' + previous_locations[67] + 'deg)'
        $("#rot_soup_spoon").html('Soup spoon: '+previous_locations[67])



    } else {
        document.getElementById('previous_button').style.visibility = 'hidden'
        initiateTable()
    }

    dataobj.trialNumber.pop()
    dataobj.locations.pop()
    console.log(dataobj)

    refreshPhotos()
});

function movedAfter(left_before, top_before, offset){
    return moved(left_before, top_before, offset.left, offset.top)
}

function moved(left_before, top_before, left_after, top_after){
    if (Math.abs(left_before-left_after) + Math.abs(top_before-top_after) < 2){
        return false;
    } else {
        return true;
    }
}

function refreshPhotos(){

    offset = $('#dg_bread_plate').position();
    if (movedAfter(197.2446814,105.6034718,offset)){
        $('#dg_bread_plate').draggable( 'disable' )
    } else {
        $('#dg_bread_plate').draggable( 'enable' )
    }

    offset = $('#dg_charger').position();
    if (movedAfter(48.32164001,13.03745461,offset)){
        $('#dg_charger').draggable( 'disable' )
    } else {
        $('#dg_charger').draggable( 'enable' )
    }

    offset = $('#dg_coffee').position();
    if (movedAfter(315.7017517,10.35802078,offset)){
        $('#dg_coffee').draggable( 'disable' )
    } else {
        $('#dg_coffee').draggable( 'enable' )
    }

    offset = $('#dg_napkin').position();
    if (movedAfter(177.9575577,13.68432522,offset)){
        $('#dg_napkin').draggable( 'disable' )
    } else {
        $('#dg_napkin').draggable( 'enable' )
    }

    offset = $('#dg_dinner_plate').position();
    if (movedAfter(214.4677658,9.324058533,offset)){
        $('#dg_dinner_plate').draggable( 'disable' )
    } else {
        $('#dg_dinner_plate').draggable( 'enable' )
    }

    offset = $('#dg_water_glass').position();
    if (movedAfter(157.9165115,109.3443751,offset)){
        $('#dg_water_glass').draggable( 'disable' )
    } else {
        $('#dg_water_glass').draggable( 'enable' )
    }

    offset = $('#dg_wine_glass').position();
    if (movedAfter(44.02829742,135.6775379,offset)){
        $('#dg_wine_glass').draggable( 'disable' )
    } else {
        $('#dg_wine_glass').draggable( 'enable' )
    }

    offset = $('#dg_wine_glass_2').position();
    if (movedAfter(84.16909933,136.74827,offset)){
        $('#dg_wine_glass_2').draggable( 'disable' )
    } else {
        $('#dg_wine_glass_2').draggable( 'enable' )
    }

    offset = $('#dg_wine_glass_1').position();
    if (movedAfter(123.8081341,136.3137074,offset)){
        $('#dg_wine_glass_1').draggable( 'disable' )
    } else {
        $('#dg_wine_glass_1').draggable( 'enable' )
    }





    offset = $('#dg_butter_knife').position();
    if (movedAfter(354.5673141,115.9997978,offset)){
        $('#dg_butter_knife').draggable( 'disable' )
    } else {
        $('#dg_butter_knife').draggable( 'enable' )
    }

    offset = $('#dg_dessert_fork').position();
    if (movedAfter(290.832798,119.4993172,offset)){
        $('#dg_dessert_fork').draggable( 'disable' )
    } else {
        $('#dg_dessert_fork').draggable( 'enable' )
    }

    offset = $('#dg_dessert_spoon').position();
    if (movedAfter(275.8578758,121.9755554,offset)){
        $('#dg_dessert_spoon').draggable( 'disable' )
    } else {
        $('#dg_dessert_spoon').draggable( 'enable' )
    }

    offset = $('#dg_dinner_fork').position();
    if (movedAfter(321.2024384,89.50162125,offset)){
        $('#dg_dinner_fork').draggable( 'disable' )
    } else {
        $('#dg_dinner_fork').draggable( 'enable' )
    }

    offset = $('#dg_dinner_knife').position();
    if (movedAfter(383.7730827,85.19843864,offset)){
        $('#dg_dinner_knife').draggable( 'disable' )
    } else {
        $('#dg_dinner_knife').draggable( 'enable' )
    }

    offset = $('#dg_salad_fork').position();
    if (movedAfter(338.2376747,105.3717275,offset)){
        $('#dg_salad_fork').draggable( 'disable' )
    } else {
        $('#dg_salad_fork').draggable( 'enable' )
    }

    offset = $('#dg_salad_knife').position();
    if (movedAfter(367.5925255,97.77871656,offset)){
        $('#dg_salad_knife').draggable( 'disable' )
    } else {
        $('#dg_salad_knife').draggable( 'enable' )
    }

    offset = $('#dg_soup_spoon').position();
    if (movedAfter(304.0075989,104.1904354,offset)){
        $('#dg_soup_spoon').draggable( 'disable' )
    } else {
        $('#dg_soup_spoon').draggable( 'enable' )
    }


}

// Have subject read instructions and click button to close
$('#next_button').click(function() {
    refreshPhotos()
    console.log('clicked here!!!');

    var offset = 0, rotation = "0";


    offset = $('#dg_bread_plate').position();
    locations.push('bread_plate', offset.left, offset.top, rotation);

    offset = $('#dg_charger').position();
    locations.push('charger', offset.left, offset.top, rotation);

    offset = $('#dg_coffee').position();
    locations.push('coffee', offset.left, offset.top, rotation);

    offset = $('#dg_dinner_plate').position();
    locations.push('dinner_plate', offset.left, offset.top, rotation);

    offset = $('#dg_napkin').position();
    locations.push('napkin', offset.left, offset.top, rotation);

    offset = $('#dg_water_glass').position();
    locations.push('water_glass', offset.left, offset.top, rotation);

    offset = $('#dg_wine_glass').position();
    locations.push('wine_glass', offset.left, offset.top, rotation);

    offset = $('#dg_wine_glass_1').position();
    locations.push('wine_glass_1', offset.left, offset.top, rotation);

    offset = $('#dg_wine_glass_2').position();
    locations.push('wine_glass_2', offset.left, offset.top, rotation);



    rotation = document.getElementById("rot_butter_knife").innerHTML.split(':')[1].trim();
    if (rotation=="") rotation = "0";
    offset = $('#dg_butter_knife').position();
    locations.push('butter_knife', offset.left, offset.top, rotation);

    rotation = document.getElementById("rot_dessert_fork").innerHTML.split(':')[1].trim();
    if (rotation=="") rotation = "0";
    offset = $('#dg_dessert_fork').position();
    locations.push('dessert_fork', offset.left, offset.top, rotation);

    rotation = document.getElementById("rot_dessert_spoon").innerHTML.split(':')[1].trim();
    if (rotation=="") rotation = "0";
    offset = $('#dg_dessert_spoon').position();
    locations.push('dessert_spoon', offset.left, offset.top, rotation);

    rotation = document.getElementById("rot_dinner_fork").innerHTML.split(':')[1].trim();
    if (rotation=="") rotation = "0";
    offset = $('#dg_dinner_fork').position();
    locations.push('dinner_fork', offset.left, offset.top, rotation);

    rotation = document.getElementById("rot_dinner_knife").innerHTML.split(':')[1].trim();
    if (rotation=="") rotation = "0";
    offset = $('#dg_dinner_knife').position();
    locations.push('dinner_knife', offset.left, offset.top, rotation);

    rotation = document.getElementById("rot_salad_fork").innerHTML.split(':')[1].trim();
    if (rotation=="") rotation = "0";
    offset = $('#dg_salad_fork').position();
    locations.push('salad_fork', offset.left, offset.top, rotation);

    rotation = document.getElementById("rot_salad_knife").innerHTML.split(':')[1].trim();
    if (rotation=="") rotation = "0";
    offset = $('#dg_salad_knife').position();
    locations.push('salad_knife', offset.left, offset.top, rotation);

    rotation = document.getElementById("rot_soup_spoon").innerHTML.split(':')[1].trim();
    if (rotation=="") rotation = "0";
    offset = $('#dg_soup_spoon').position();
    locations.push('soup_spoon', offset.left, offset.top, rotation);



    // ----------------------
    // record final position
    // ----------------------
    dataobj['trialNumber'].push(t)
    dataobj['locations'].push(locations)

    console.log("-----------")
    console.log(dataobj)
    console.log("-----------")
    locations = []

    if (t != instructions.length-1) {

        if (t==0){
            document.getElementById('previous_button').style.visibility = 'visible'
        }

        t++;

        updateInstruction()

    } else {
        // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        // ~~~~~ Execute submission to Mechanical Turk servers ~~~~~
        // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        // Extract assignment data from the subject's URL

        var current_url = window.location.href
        var assignmentId = get_assignmentId_from_url(current_url)
        var inSandboxMode = detect_sandbox_mode(current_url)


        var data_string = JSON.stringify(dataobj)
        console.log("-----------")
        console.log("-----------")
        console.log("-----------")
        console.log(data_string)

        // Submit data via POST request
        document.getElementById("assignmentId").value = assignmentId;
        document.getElementById("submission_data").value = data_string;

        var submit_url = "https://www.mturk.com/mturk/externalSubmit"

        if (inSandboxMode == true) {
            var submit_url = "https://workersandbox.mturk.com/mturk/externalSubmit"
        } else if (inSandboxMode == false) {
            var submit_url = "https://www.mturk.com/mturk/externalSubmit"
        }
        document.getElementById("Mechanictitleurk_SubmissionForm").action = submit_url

        try {
            // ~~~~~ Uncomment the line below before you upload to mechanical turk ~~~~~
            document.getElementById("Mechanictitleurk_SubmissionForm").submit();
            console.log('EXECUTED SUBMISSION TO TURK')
        } catch (error) {
            console.log(error)
        }
    }

});


// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
// ~~~~~ Main workflow. Store the results in the variable 'dataobj' ~~~~~
// ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

var dataobj = {}
dataobj['trialNumber'] = []
dataobj['locations'] = []

var datafile = 'instructions/ins_'+ Math.floor(Math.random()*3) +'.json';
console.log(datafile)


$.ajaxSettings.async = false;
$.getJSON(datafile, function(data) {
    dataobj['trialVideo'] = data.video_name;
    dataobj['instructions'] = data.instructions;
});
$.ajaxSettings.async = true;

var instructions = dataobj.instructions;
console.log(instructions)

// ----------------------
// initialize and record new position
// ----------------------

var locations = [];
initiateTable();

var t = 0;

updateInstruction()


</script>

</html>
